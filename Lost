using System;
using System.Runtime.Intrinsics.Arm;
using System.Security.AccessControl;
using System.Security.Cryptography.X509Certificates;


    internal class Book
    {
        //two or more overloaded constructor عاوزين هنا
        public Book()
        {
            title = "Unavailable";
            ISBN = "000-0-00-000000-0";
            genre = "General";
            publicationyear = 0;
            volumeNum = 0;
            //author = new Author[5];
        }
        public string title { get; set; }
        public string author { get; set; }
        public string genre { get; set; }
        private int publicationyear;
        public int _publicationyear
        {
            set
            {
                if (value <= 0 || value > 2025)
                { throw new ArgumentException("incorrect year"); } // هيرمي خطأ لل cache تحت بيديها انذار ان في حاجه غلط وهي المفروض تستلمها وجمله الطباعه هنا لا تطبع 

                else
                { publicationyear = value; } //  publicationyear=_publicationyear
            }
            get { return publicationyear; }
        }
        private string ISBN;
        public string _ISBN       //Property
        {
            set
            {
                if (publicationyear <= 2007 && value.Length == 10)
                {
                    ISBN = value;
                }
                else if (publicationyear > 2007 && value.Length == 13)
                {
                    ISBN = value;
                }
                else
                {
                    throw new ArgumentException("ISBN consists of 10 numbers(before 2007) or 13 numbers(after 2007)");
                }
            }
            get { return ISBN; }
        }
        private int volumeNum;
        public int _volumeNum      //Property
        {
            set
            {
                if (value <= 0 || value > 3000)
                { throw new ArgumentException("incorrect or overloaded volume"); }

                else
                { volumeNum = value; }
            }
            get { return volumeNum; }
        }
        public override string ToString()
        { return $"The Book Tilte={title} \n Book Genre={genre}\n publication year ={publicationyear} \n ISBN for Book ={ISBN} \n volume of the Book ={volumeNum} "; }
    }
    internal class FictionBook : Book
    {
        private string[] Characters;
        private string TargetAudience;
        public FictionBook()
        {
            Characters = new string[0];
            TargetAudience = "General";
        }


        public string _TargetAudience
        { set {
                if (value == "young" || value == "adult" || value == "old")
                { TargetAudience = value; }
                else { throw new ArgumentException("unvalid option"); }

            }
            get { return TargetAudience; }
        }

        public void SetFictionCharacters(string[] characters)
        {
            this.Characters = characters;
        }

        public string[] GetFictionCharacters()
        {
            return Characters;
        }

        //public override string ToString()
        //{
        //    return $"TargetAudiance={TargetAudience}";
        //}
    }
    internal class NonFictionBook : Book
    {
       private string FeildStudy;
        private string[] References;
        private int EditionNumber;

        public NonFictionBook()
        {
            FeildStudy = "General";
            References = new string[0];
            EditionNumber = 0;
        }
        public string feildstudy { get { return FeildStudy; } set { FeildStudy = value; } }
        public int editionnum { get { return EditionNumber; } set { EditionNumber = value; } }
        public void SetReferences(string[] references)
        {
            this.References = references;
        }
        public string[] GetReferences()
        {
            return References;
        }
    }

    internal class Author
    {
        //two or more overloaded constructor عاوزين هنا

        private string Name;
        private string Birthdate;
        Book[] BooksWritten;
        public Author()
        {
            Name = "Unknown";
            Birthdate = "01/01/1900";
            BooksWritten = new Book[0];
        }
        public string name {  get; set; }
        public string birthdate {  get; set; }
        public override string ToString()
        {
            return $"Author Name is : {name} \n Author Birthdate : {birthdate}";
        }
    }

    internal class PoetAuthor : Author
    {
        private string[] Poems;
        private string PoetryStyle;

        public PoetAuthor()
        {
            PoetryStyle = "General";
            Poems = new string[0];
        }
        public void SetPoems(string[] poems)
        {
            this.Poems = poems;
        }
        public string[] GetPoems()
        {
            return Poems;
        }
        public string _PoetryStyle
        {
            set { PoetryStyle = value; }
            get { return PoetryStyle; }
        }
    }
    internal class Novelistauthor : Author
    {
        private string[] Awards;
        private string WritingStyle;

        public Novelistauthor()
        {
            WritingStyle = "General";
            Awards = new string[0];
        }
        public void SetAwards(string[] awards)
        {
            this.Awards = awards;
        }
        public string[] GetAwards()
        {
            return Awards;
        }
        public string _WritingStyle
        {
            get{ return WritingStyle;}
            set {  WritingStyle = value; }
        }
    }
    internal class Library
    {
        //كل الدوال الاساسيه بتاعتي هنا

        public static int checkinput() // التحقق من صحة الادخال ارقاااااااااام
        {
            while (true)
            {
                try
                {
                    string input = Console.ReadLine();
                    if (!string.IsNullOrWhiteSpace(input)) // Check for non-empty input
                    {
                        int inp = int.Parse(input);
                        return inp;
                    }
                }
                catch
                {
                    Console.WriteLine("Invalid input. Please enter a valid number:");
                }
            }
        }
        public static string ReadNonEmptyString() // التحقق من صحة الادخال نصوص مش فاضية
        {
            while (true)
            {
                string input = Console.ReadLine(); //"enter"
                if (!string.IsNullOrWhiteSpace(input)) // Check for non-empty input
                {
                    return input;
                }
                Console.WriteLine("Input cannot be empty. Please try again:");
            }
        }

        Book[] books; //كل الكتب هتتخزن هنا 
        private int CurrentBookCount = 0;
        Author[] Authors; //كل المؤلفين هيبقو هنا
        private int CurrentAuthorCount;
        char bookType = ' ';
        FictionBook NewBook1 = new FictionBook(); ////////////////////////////
        int numberofcharacters = 0;
        string[] characters;
        NonFictionBook NewBook2 = new NonFictionBook(); ///////////////////////////////
        int numberofreferences = 0;
        string[] references;
        char authortype = ' ';
        Novelistauthor NewAuthor1;
        PoetAuthor NewAuthor2;
        int numberofawards;
        string[] awards;
        string[] poems;
        int numberofpoems;
        Author author;
        int NumberOfAuthorForOneBook = 0;
        public Library()
        {
            books = new Book[100];//maximum books
            Authors = new Author[500];//maximum authors
            CurrentAuthorCount = 0;
        }
        public void addbook()
        {
            Book book = new Book();

            if (CurrentBookCount < books.Length) //بنشيك علي عدد الكتب الموجوده تخطي الحد الاقصي ولا لا 
            {
                //عنوان الكتاب ملوش شروط
                Console.WriteLine("please enter the Book title");
                book.title = ReadNonEmptyString();
                //سنة النشر
                bool checkpublicationyear = false;
                while (!checkpublicationyear) //انفينيتي لووب عشان لو دخلت حاجه غلط يرجعني وميخرجش الا لما اكتب صح بشروطي الل انا حاططها
                {
                    Console.WriteLine("please enter the Book publication year");
                    int year = checkinput(); //نتاكد هي رقم ولا لا اصلا
                    try
                    {
                        book._publicationyear = year; //اطلع شييك علي شروطها في الكلاس شوفها اتحققت ولا لا 
                        checkpublicationyear = true;    //للخروج من الانفينتي لووب
                    }
                    catch (Exception) { Console.WriteLine("please enter a valid year"); } // بتستلم الخطأ الل try بعتته فوق ويطبعلك الجمله دي 
                }
                // ISBN
                bool checkisbn = false;
                while (!checkisbn)
                {
                    Console.WriteLine("Enter the Book ISBN");
                    string input = ReadNonEmptyString();  
                    try
                    {
                        book._ISBN = input;
                        checkisbn = true;
                    }
                    catch (Exception)
                    { Console.WriteLine("Please enter ISBN from 10 numbers(before 2007) or 13 numbers(after 2007) "); }
                }
                //حجم الكتاب
                bool checkvol = false;
                while (!checkvol)
                {
                    Console.WriteLine("Please enter the Volume Number of the book:");
                    int volumeNumber = checkinput();
                    try
                    {
                        book._volumeNum = volumeNumber;
                        checkvol = true;
                    }
                    catch (Exception)
                    { Console.WriteLine("please enter a correct volume"); }

                }

                //نوع الكتاب
              
                while (true)
                {
                    Console.WriteLine("please enter the Book genre : 'F' for Fiction or 'N' for Non-Fiction :");
                    string input = ReadNonEmptyString().ToUpper();
                    
                    bookType = input[0];
                    if (bookType != 'F' && bookType != 'N')
                    {
                       Console.WriteLine("Invalid input, please enter 'F' or 'N' \n");
                        continue;
                    }
                    else
                    {
                        break; // طلعت برا الانفينتي لووب
                    }
                }

                if (bookType == 'F')
                {
                    book.genre = "book genre is fiction";
                    AddFictionBook(NewBook1);
                }

                else if (bookType == 'N')
                {
                    book.genre = "book genre is Nonfiction";

                  NewBook2 = new NonFictionBook();
                    AddNonFictionBook(NewBook2);
                }

                //معلومات الكاتبببببب

              Console.WriteLine("How many authors does the book have?");
                NumberOfAuthorForOneBook = checkinput();
                 author = new Author();
                //string authorName = "";
                //string authorBirthdate = "";
                for (int i = 0; i < NumberOfAuthorForOneBook; i++)
                {
                    Authors[i] = author;
                    Console.WriteLine("Please enter details for Author " + (i + 1) + ":" + "\n");
                    Console.WriteLine("Please enter the Author's Name:");
                    author.name= ReadNonEmptyString();
                   Console.WriteLine("Please enter the Author's Birthdate (DD/MM/YYYY):");
                    author.birthdate = ReadNonEmptyString();
                    Console.WriteLine($"which type of Author {i + 1} 'N' for Novelist or 'P' for Poem :");
                    while (true)
                    {
                        Console.WriteLine("Enter 'P' for Poem Author or 'N' for Novelist Author :");
                        string input = ReadNonEmptyString().ToUpper();
                     
                        authortype = input[0];
                        if (authortype != 'P' && authortype != 'N')
                        {
                           Console.WriteLine("Invalid input, please enter 'P' or 'N' \n");
                            continue;
                        }
                        else
                        {
                            break;
                        }
                    }
                    if (authortype == 'N')
                    {
                        Console.WriteLine("You selected Novelist Author." + "\n");
                         NewAuthor1 = new Novelistauthor();
                       Console.WriteLine("Please enter the Writing Style of the novelist:");
                        string writingStyle = ReadNonEmptyString();
                        NewAuthor1._WritingStyle = writingStyle;
                       Console.WriteLine("How many awards has the novelist won?");

                        numberofawards = checkinput();
                         awards = new string[numberofawards];
                        for (int j = 0; j < numberofawards; j++)
                        {
                            Console.WriteLine("Enter the name of award " + (j + 1) + ":");
                            awards[j] = ReadNonEmptyString();
                        }
                        NewAuthor1.SetAwards(awards);
                    }
                    else
                    {
                        Console.WriteLine("You selected Poet Author." + "\n");

                        PoetAuthor NewAuthor2 = new PoetAuthor();

                        Console.WriteLine("Please enter the Poetry Style of the poet:");
                        string poetryStyle = ReadNonEmptyString();
                        NewAuthor2._PoetryStyle = poetryStyle;

                        Console.WriteLine("How many poems has the poet written?");
                         numberofpoems = checkinput();

                         poems = new string[numberofpoems];
                        for (int j = 0; j < numberofpoems; j++)
                        {
                            Console.WriteLine("Enter the name of poem " + (j + 1) + ":");
                            poems[j] = ReadNonEmptyString();
                        }
                        NewAuthor2.SetPoems(poems);
                    }
                }
                books[CurrentBookCount] = book;
                CurrentBookCount++;
                Console.WriteLine("the total number of book : "+ CurrentBookCount);
            }
            else
            {
                Console.WriteLine("Library is full, cannot add new book");
            }
        }
        // نوعين الكتاب => للكلاسين اللي وارثين من الكتاب
                public void AddFictionBook(FictionBook NewBook1)
        {
            Console.WriteLine("You selected Fiction book.\n");

            bool target = false;
            while (!target)
            {
                Console.WriteLine("Please enter the Target Audience of the book: \" young or adult or old\" ");
                string targetAudience = ReadNonEmptyString();
                try
                {
                    NewBook1._TargetAudience = targetAudience;
                    target = true;
                }
                catch (Exception)
                { Console.WriteLine("please enter a valid option"); }
            }
           Console.WriteLine("How many main characters are in the book?");
             numberofcharacters = checkinput();
             characters = new string[numberofcharacters];
            for (int i = 0; i < numberofcharacters; i++)
            {
               Console.WriteLine("Enter the name of character " + (i + 1) + ":");
                characters[i] = ReadNonEmptyString();
            }
            NewBook1.SetFictionCharacters(characters);
        }
        public void AddNonFictionBook(NonFictionBook NewBook2)
        {
            Console.WriteLine("You selected NonFiction book.\n");

            Console.WriteLine("Please enter the Field of Study:");
            string field = ReadNonEmptyString();
            NewBook2.feildstudy=field;

            Console.WriteLine("Please enter the Edition Number:");
            int editionNumber = checkinput();
            NewBook2.editionnum = editionNumber;

            Console.WriteLine("How many references are in the book?");
             numberofreferences = checkinput();
           references = new string[numberofreferences];
           
            for (int i = 0; i < numberofreferences; i++)
            {
                Console.WriteLine("Enter the name of reference " + (i + 1) + ":");
                references[i] = ReadNonEmptyString();
            }
            NewBook2.SetReferences(references);
        }
        public void DisplayBookDetails()
        {
            bool isbookexist = false;
            if (CurrentBookCount != 0)
            {
                Console.WriteLine("enter the book Name");
                string searchbookname = ReadNonEmptyString();
                for (int i = 0; i < CurrentBookCount; i++)
                {
                    if (books[i].title == searchbookname)
                    {
                        Console.WriteLine(books[i]);
                         isbookexist = true;
                    }
                    else { continue; }
                }
                if (isbookexist == false) { Console.WriteLine("Unavailable Book"); }
                //طباعه الكاتب => ممكن يكون اكتلا من واحد
                for (int i = 0; i < NumberOfAuthorForOneBook; i++)
                {
                    Console.WriteLine(Authors[i]);
                }
                    // طباعه معلومات الكلاسات الفرعيه
                    if (bookType == 'F') { Console.WriteLine("the target Audiance is : "+NewBook1._TargetAudience);
                    for (int i = 0; i < numberofcharacters; i++)
                    {
                        Console.WriteLine($"character{i+1} : {characters[i]}");
                    }
                }
                else if (bookType == 'N') 
                { Console.WriteLine("the feild study is : "+NewBook2.feildstudy);
                    Console.WriteLine("Edition Number is :"+NewBook2.editionnum);
                    for (int i = 0; i < numberofreferences; i++)
                    { Console.WriteLine($"reference{i+1}={references[i]}"); }
                }
                if (authortype == 'N')
                {
                    Console.WriteLine("the wrirting style : " + NewAuthor1._WritingStyle);
                    for (int j = 0; j < numberofawards; j++)
                    { Console.WriteLine($"Award {j+1} : {awards[j]}"); }
                }
                else if (authortype == 'P')
                {
                    Console.WriteLine("the Poetry style : " + NewAuthor2._PoetryStyle);
                    for (int j = 0; j <numberofpoems; j++)
                    { Console.WriteLine($"Poem{j + 1} : {poems[j]}"); }
                }
            }
            else { Console.WriteLine("there is no books in the Library \n"); }
        }
        public void SearchBookByAuthor()
        {
            bool isauthorexist = false;
            if (CurrentBookCount != 0)
            {
                Console.WriteLine(" Please Enter Author Name");
                string authorsearch = ReadNonEmptyString();

                for (int i = 0; i < CurrentAuthorCount; i++)
                {
                    if (Authors[i].name == authorsearch)
                    {
                        Console.WriteLine();
                        isauthorexist = true;
                    }
                    else { continue; }
                }
                if (isauthorexist == false) { Console.WriteLine("Unavailable Author"); }
            }
            else { Console.WriteLine("there is no books in the Library \n"); }
        }
    }
    internal class LibraryManagementSystem
    {
        static void Main(string[] args)
        {//هنعمل الاوبشنز وفي كل اوبشن هنبقى عاملينله داله ونستدعيها 
            Library library = new Library();
            string option;
            while (true)
            {
                Console.WriteLine("WELCOME TO LOST LIBRARY ");
                Console.WriteLine("1. Add Books");
                Console.WriteLine("2. Display a Book details");
                Console.WriteLine("3. search a Book by Author");
                Console.WriteLine("4. exit");
                Console.Write("please select an option (1-4) : ");

                option =Console.ReadLine();
                switch (option) 
                {
                    case "1":
                        Console.WriteLine("* Adding a Book *");
                        library.addbook();
                        Console.WriteLine("book added successfully ! \n");
                        break;

                    case "2":
                        Console.WriteLine("* Display book details *");
                    library.DisplayBookDetails();
                        break;

                    case "3":
                        library.SearchBookByAuthor();
                        break;

                    case "4":
                        Console.WriteLine("Exiting the system. Goodbye!");
                        return;

                    default :
                        Console.WriteLine("Invalid choice. Please try again." + "\n");
                        break;
                }
            }
        }
    }
